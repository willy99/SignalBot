from typing import Final, Dict, List

# EXCEL FILE COLUMNS FOR DESERTERS (А0224 СЗЧ.XLSX)
NA : Final = '' # порожня ячейка, інформація не додана або не змогли витягнути
DEFAULT_MIL_UNIT : Final = 'А0224'

# Відповідність назв колонок в екселі
COLUMN_INCREMEMTAL : Final = '№'
COLUMN_INSERT_DATE : Final = 'Дата внесення'
COLUMN_DESERTION_DATE : Final = 'Дата СЗЧ'
COLUMN_RAPORT_DATE : Final = 'Дата Рапорт'
COLUMN_MIL_UNIT : Final = 'Військова частина'
COLUMN_SERVICE_TYPE : Final = 'Від служби'
COLUMN_TITLE : Final = 'Військове звання'
COLUMN_NAME : Final = 'ПІБ'
COLUMN_DESERTION_PLACE : Final = 'Звідки СЗЧ'
COLUMN_SUBUNIT : Final = 'Підрозділ'
COLUMN_SUBUNIT2 : Final = 'Підрозділ2'
COLUMN_DESERTION_REGION : Final = 'Звідки СЗЧ н.п. обл'
COLUMN_BIRTHDAY : Final = 'Дата народження'
COLUMN_ID_NUMBER : Final = 'РНОКПП'
COLUMN_ENLISTMENT_DATE : Final = 'Дата призову на військову службу'
COLUMN_DESERT_CONDITIONS : Final = 'Дата, час обставини та причини самовільного залишення військової частини або місця служби'
COLUMN_BIO : Final = 'Біографічні дані, дата призову та яким РТЦК та СП Призваний'
COLUMN_TZK : Final = 'РТЦК'
COLUMN_ADDRESS : Final = 'Адреса проживання'
COLUMN_PHONE : Final = '№ телефону'
COLUMN_EXECUTOR : Final = 'Виконавець'
COLUMN_SERVICE_DAYS : Final = 'термін служби до СЗЧ'
COLUMN_RETURN_DATE : Final = 'Дата повернення до в/частини'

PATTERN_TITLE_MAPPING: Final[Dict[str, str]] = {
    # Складні звання (спочатку перевіряємо їх, щоб не "з'їсти" частину)
    r'(?i)молодш[а-я]{1,3}\s+лейтенант[а-я]{0,3}': 'молодший лейтенант',
    r'(?i)старш[а-я]{1,3}\s+лейтенант[а-я]{0,3}': 'старший лейтенант',
    r'(?i)головн[а-я]{1,3}\s+сержант[а-я]{0,3}': 'головний сержант',
    r'(?i)молодш[а-я]{1,3}\s+сержант[а-я]{0,3}': 'молодший сержант',
    r'(?i)старш[а-я]{1,3}\s+сержант[а-я]{0,3}': 'старший сержант',
    r'(?i)штаб-сержант[а-я]{0,3}': 'штаб-сержант',
    r'(?i)старш[а-я]{1,3}\s+солдат[а-я]{0,3}': 'старший солдат',

    # Офіцери
    r'(?i)підполковник[а-я]{0,3}': 'підполковник',
    r'(?i)полковник[а-я]{0,3}': 'полковник',
    r'(?i)майор[а-я]{0,3}': 'майор',
    r'(?i)капітан[а-я]{0,3}': 'капітан',
    r'(?i)лейтенант[а-я]{0,3}': 'лейтенант',

    # Рядовий та сержантський склад
    r'(?i)сержант[а-я]{0,3}': 'сержант',
    r'(?i)солдат[а-я]{0,3}': 'солдат',
    r'(?i)матрос[а-я]{0,3}': 'матрос',

    # Специфічні терміни
    r'(?i)військовослужбов[а-я]{2,4}': 'солдат',
    r'(?i)офіцер[а-я]{0,3}': 'офіцер',
}

# маппінг підрозділів
PATTERN_SUBUNIT_MAPPING : Final[Dict[str, str]] = {
    # Пріоритет: спочатку довші назви, потім коротші
    r'(?i)(\d+)?\s*десант(?:но)?[- ]?штурмов(?:ого|ий)\s*батальйон(?:у|) ': r'\1 дшб',
    r'(?i)аеромобільн(?:ого|ий)\s*батальйон(?:у|)': 'АЕМБ',
    r'(?i)батальйон(?:у|)\s*безпілотних\s*систем': 'ББС',
    r'(?i)(\d+)?\s*артилерійськ(?:ої|а)\s*батареї?': r'\1 артбатарея',
    r'\перехоплювачів безпілотних літальних апаратів\b': 'БатПБПЛА',
    r'(?i)самохідн(?:ого|ий)\sартилерійськ(?:ого|ий)\sдивізіон(?:у|)': 'САДН',
    r'\bАЕМБ\b': 'АЕМБ',
    r'\b(\d+)\s*дшб\b': r'\1 дшб',
    r'\bРУБАК\b': 'РУБАК',
    r'\bББпС\b': 'ББС',
    r'\bББС\b': 'ББС',
    r'\bТР\b': 'ТР',
    r'\bЗРАДн\b': 'ЗРАДн',
    r'\bСАДн\b': 'САДн',
    r'\bв розпорядженні\b': 'в розпорядженні',
    r'\ГІЗ\b': 'ГІЗ',
    r'\РР\b': 'РР',
    r'\РХБЗ\b': 'РХБЗ',
    r'\РПТРК\b': 'РПТРК',
    r'\РеАБатр\b': 'РеАБатр',
    r'\БУ\b': 'БУ',
    r'\БУтаАР\b': 'БУтаАР',
    r'\РС\b': 'РС',
    r'\РЕБ\b': 'РЕБ',
    r'\ІСР\b': 'ІСР',
    r'\Управління\b': 'Управління',
    r'\МР\b': 'МР',
}

# мапінг звідки тіканув
PATTERN_DESERTION_PLACE_MAPPING : Final[Dict[str, str]] = {
    r'(?i)район[у\s]+виконання\s+(?:бойового\s+)?(завдан[(ня|нь)\s]*)(за\s+призначенням)?': 'РВБЗ',
    r'(?i)після\s+проходження\s+військово-лікарської\s+комісії': 'відрядження',
    r'(?i)курсанта\s+.*?навчальної\s+роти': 'НЦ',
    r'(?i)не\s+повернувся\s+з\s+лікування': 'лікування',
    r'(?i)з\s(пункту\sпостійної|постійного\sпункту)\sдислокації\s': 'ППД',
    r'(?i)після\s+огляду\s+(військово-лікарської\s+комісії|влк)': 'ВЛК',
    r'(?i)(?:повернув(?:ся|ось|нення)|не\s*прибуття|не\s+прибув)(?:\s+з)?\s+відпустки': 'відпустки',
}

# Мапінг типів служби: Регулярний вираз -> Результат
PATTERN_SERVICE_TYPE_MAPPING: Final[Dict[str, str]] = {
    r'(?i)приз[ио]вом|мобілізаці': "призовом",
    r'(?i)контрактом': "контрактом"
}

PATTERN_CLEANUP_POINTS: Final = ':;,. '
# Патерн для розділення тексту на абзаци
PATTERN_PARAGRAPH_SPLIT: Final = r'[\r\n]{2,}'


PATTERN_NAME : Final = r'\b(([А-ЩЬЮЯҐЄІЇʼ-]{3,}\s?){1,2})\s+([А-ЯҐЄІЇ][а-яґєії\']{1,}(?:-[А-ЯҐЄІЇ][а-яґєії\']{1,})?)\s+(([А-ЯҐЄІЇ][а-яґєії\-\']{2,}\s?){1,2})\b'
PATTERN_STRICT_NAME = r'^(?!(?:СМТ|ВУЛ|ОБЛ|Р-Н)\b)\b(([А-ЩЬЮЯҐЄІЇʼ-]{3,}\s?){1,2})\s+([А-ЯҐЄІЇ][а-яґєії\']{2,})\s+(([А-ЯҐЄІЇ][а-яґєії\-\']{2,}\s?){1,2})\b'

# Маркери ідентифікаційного коду
PATTERN_ID_MARKER: Final = r'(?i)(?:РНОКПП|ІПН|І\.П\.Н\.|РНОК\s*ПП)'
PATTERN_ID_ABSENCE: Final = r'(?i)(відсутн|не надано|немає|відомості)'
PATTERN_ID_DIGITS: Final = r'(\d{10})\b'
PATTERN_ID_STANDALONE: Final = r'\b([1-9]\d{9})\b'

# Повний патерн для пошуку телефону з маркером та різними форматами запису
PATTERN_PHONE: Final = r'(?i)(?:номер|(?:ефон(у)?)|тел\.)[\s\w.:+]*?(\+?\s?3?8?[\s(-]*0\d{2}[\s)-]*\d{3}[\s-]*\d{2}[\s-]*\d{2})\b'

# Патерн для пошуку РТЦК
#PATTERN_RTZK: Final = r'(?i)((?:[А-ЯҐЄІЇ-][^.,!?\s]*\s+){1,5}?(?:О?РТЦК|ТЦК|ВРК|МТЦК)(?:\s*(?:та|&)?\s*СП)?(?:\s?,?\s+м\.\s+[А-ЯІЇЄа-яіїє\-\']+,?(?:\s+[А-ЯІЇЄа-яіїє\-\']+)*|\s+[А-ЯІЇЄа-яіїє\']+\s+обл\.?)?)'
PATTERN_RTZK: Final = r'(?i)((?:[А-ЯҐЄІЇ-][^.,!?\s]*\s+){1,5}?(?:О?РТЦК|ТЦК|ВРК|МТЦК)(?:\s*(?:та|&)?\s*СП)?(?:[\s,]+(?:м\.|місто)\s+[\w\-\']+(?:\s+[\w\-\']+)*)?(?:[\s,]+[\w\-\']+\s+(?:області|обл\.?))?)'

# Патерн для видалення дати в кінці знайденого блоку
PATTERN_RTZK_DATE_CLEANUP: Final = r'\s*,?\s*\d{2}\.\d{2}\.\d{2,4}.*$'
# Список "сміттєвих" патернів для очищення результату
PATTERN_RTZK_TRASH: Final[List[str]] = [
    r'(?i)призваний\s+',
    r'(?i)призвана\s+',
    r'(?i)яким\s+',
    r'(?i)на\s+військову\s+службу\s+',
    r'(?i)за\s+призовом\s+',
    r'(?i)під\s+час\s+мобілізації\s+',
    r'(?i)з\s+\d{2}\.\d.2\.\d{2,4}',
    r'(?i)^(на військову службу|призваний)\s+' # Патерн для очищення на початку рядка
]
PATTERN_RTZK_CALLED: Final =r'(?i)^(на військову службу|призваний)\s+'

PATTERN_DATE: Final = r'(\d{2}\.\d{2}\.(?:\d{4}|\d{2}))'
PATTERN_BIRTHDAY: Final = PATTERN_DATE + '\s*(?:року\s+народження|р\.н\.|народження)'
PATTERN_BIRTHDAY_FALLBACK = r'\b(\d{2}\.\d{2}\.\d{4})\b'

PATTERN_DESERTION_DATE: Final = PATTERN_DATE + '(?=\s+року\s+(?:під час перевірки|був відсутній|самовільно залишив))'

PATTERN_ADDRESS_MARKER: Final = r'Адреса\s+(?:проживання|реєстрації)'
PATTERN_ADDRESS_CLEANUP_PREFIX: Final = r'^(?:\s*військовослужбовця)?\s*:?\s*'
PATTERN_ADDRESS_CONTENT: Final = r'^((?:(?!Мати:|Батько:|Дружина:|Родичі:|Близькі|тел\.|;|\n).)+)'

PATTERN_MIL_UNIT: Final = r'\b[А-ЯA-Z]\d{4}\b'

# Маркери, що вказують на процес перевірки
# Маркери, що вказують на сам факт відсутності
PATTERN_DESERT_CHECK_MARKERS: Final[List[str]] = [
    "під час перевірки",
    "під час шикування",
    "перевірці наявності"
]
PATTERN_DESERT_ABSENCE_MARKERS: Final[List[str]] = [
    "відсутн",
    "виявлено відсутність",
    "не було в наявності",
    "не поверн",
    "не прибуття",
    "неповерненн",
    "429 ККУ",
    "факт самовільного залишення",
]

# Маркери, що вказують на повернення або прибуття військовослужбовця
PATTERN_RETURN_MARKERS: Final[List[str]] = ["був присутній", "несвоєчасно прибув"]
PATTERN_RETURN_DATE: Final = PATTERN_DATE + '\s+(року.*? (?:був\s+присутній|несвоєчасно\s+прибув))'


PATTERN_DESERTION_REGION_MAIN: Final = r'(?i)(?:н\.п\.|с\.|м\.|село|місто|селище|смт)\s+([А-ЯҐЄІЇ][^.;]*?(?:області|обл\.))'
PATTERN_DESERTION_REGION_BACKUP: Final = r'(?i)([А-Я][а-яіЇє]*?\s+район[у|а]\s+[А-Я][а-яіЇє]*?\s+області)'




#### регулярки для шматків тексту ####
PATTERN_PIECE_HEADER_START : Final = 'ДОПОВІДЬ'
PATTERN_PIECE_HEADER_END : Final = r'1\.\s+Дата\s+і\s+час\s+скоєння'

PATTERN_PIECE_1_START : Final = r'матеріальна\s+та\s+моральна\s+шкода\)\.'
PATTERN_PIECE_1_END : Final = r'2\.\s+Коли,\s+яким\s+органом'

PATTERN_PIECE_3_START : Final = r'(?:Стислі демографічні дані|Адреса проживання.*?Близькі родичі|Близькі родичі.*?Адреса проживання|призваний на військову службу, освіта, сімейний стан)'
PATTERN_PIECE_3_END : Final = r'\b4[\.\s\)]+(?:Хто проводить|Службове розслідування)'

PATTERN_PIECE_4_START : Final = r'Хто проводить службове розслідування, строки його проведення\.'
PATTERN_PIECE_4_END : Final = r'5[\.\s\)]+Військове звання'
